@using System.Data
@using b2b_solution.Models
@using System.Collections.Generic
@using System.Collections

@{
    DataModel dm = new DataModel();

    ViewBag.Title = "NewSupport";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<main class="main">
    <div class="container mb-80 mt-50">

        <div class="row">



            <div class="col-lg-7">

                <div class="row">
                    <h4 class="mb-30">New Support Request</h4>
                    <form method="post">
                        <div class="row">
                            <div class="form-group col-lg-6">
                                <input type="text" id="title" style="height:35px" autocomplete="off" name="fname" placeholder="Title*">
                                <label id="lbltitle" style="color:red; font-size:small"></label>
                            </div>
                            <div class="form-group col-lg-6">
                              
                                @(Html.Kendo().DropDownList() 
                .Name("Reason")
                .HtmlAttributes(new { style = "width:100%; background-color:white !important", @class="form-control" })
                .OptionLabel("Select Reason")
                .DataTextField("ReasonName")
                .DataValueField("ReasonCode")
                .DataSource(source => source
                        .Read(read =>
                        {
                            read.Action("GetReasons", "Support");
                        }))
                )

                                <label id="lblreason" style="color:red; font-size:small"></label>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-lg-6">
                                <textarea id="message" rows="2" style="min-height:80px" placeholder="Message*"></textarea>
                                <label id="lblmessage" style="color:red; font-size:small"></label>
                            </div>
                            <div class="form-group col-lg-6">
                                @(Html.Kendo().Upload()
        .Name("files")
        .Async(a => a
            .Save("Async_Save", "Support")
            .Remove("Async_Remove", "Support")
            .AutoUpload(true)
        )
    )
                            </div>

                        </div>
                    </form>
                </div>

                <div class="row">

                    <form method="post">
                        <div class="row">
                            <div class="form-group col-lg-6">

                                <a onclick="SubmitReq()" class="btn btn-fill-out btn-block mt-30">Submit Request<i class="fi-rs-sign-out ml-15"></i></a>
                            </div>

                        </div>

                    </form>


                </div>
            </div>

        </div>
    </div>
</main>




<div class="modal fade custom-modal" id="SuccessRes" tabindex="-1" aria-labelledby="quickViewModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            <div class="modal-body">
                <div class="timeline">
                    <div class="col-lg-12">
                        <div class="form-group">
                            <h4> New support request has been generated, our team will update you soon ( <span id="OrderID"></span> )</h4>
                        </div>
                        <div class="form-group" style="margin-top: 25px; text-align-last:end">
                            <button style="background-color:lightcoral" onclick="DismissSuccess()" class="btn btn-secondary ">OK</button>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade custom-modal" id="FailureRes" tabindex="-1" aria-labelledby="quickViewModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            <div class="modal-body">
                <div class="timeline">
                    <div class="col-lg-12">
                        <div class="form-group">
                            <h4 style="color:red"> We are facing some technical issues now, please try again later <img height="40" src="../Content/imgs/order/sad.png" />  </h4>
                        </div>

                        <div class="form-group" style="margin-top: 25px; text-align-last:end">
                            <button style="background-color:lightcoral" onclick="DismissModelRes()" class="btn btn-secondary ">OK</button>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .k-dropdown-wrap.k-state-default{
        background-color:white !important
    }
    .k-dropzone {
        background-color: white !important
    }
</style>


<script>

    function DismissModelRes() {
        $('#FailureRes').modal('hide');
    }

    function ShowSuccess() {
        $('#SuccessRes').modal('show');
    }

    function ShowFailure() {
        $('#FailureRes').modal('show');
    }


    function DismissSuccess() {
         window.location.href = '@Url.Action("ViewSupports", "Support")';
    }


     function SubmitReq() {
        var x = ValidateControls();
        if (x == true) {

            var title = document.getElementById("title").value;
            var reason = $("#Reason").data("kendoDropDownList").value(); 
            var message = document.getElementById("message").value;

            $.ajax({
                type: "GET",
                url: '@Url.Action("NewRequest", "Support")',
                contentType: "application/json; charset=utf-8",
                data: {
                    "Title": title,
                    "Reason": reason,
                    "Message": message
                },
                dataType: "json",
                success: function (data) {
                    if (data.mode == 1) {
                        ShowSuccess();
                        $('#OrderID').text(data.message)
                    } else {
                        ShowFailure();
                      
                    }
                }
            });
        }
    }

    function ValidateControls() {
        var valCount = 0;
        if (document.getElementById("title").value == "") {
            valCount++;
            document.getElementById("lbltitle").innerHTML = "Please enter title";
        } else {
            document.getElementById("lbltitle").innerHTML = "";
        }

        if ($("#Reason").data("kendoDropDownList").value() == "") {
            valCount++;
            document.getElementById("lblreason").innerHTML = "Please enter reason";
        } else {
            document.getElementById("lblreason").innerHTML = "";
        }

        if (document.getElementById("message").value == "") {
            valCount++;
            document.getElementById("lblmessage").innerHTML = "Please enter message";
        } else {
            document.getElementById("lblmessage").innerHTML = "";
        }

        if (valCount > 0) {
            return false;
        } else {
            return true;
        }

    }


</script>